<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Solve Optimal Control problem · BoundaryValueDiffEq.jl</title><meta name="title" content="Solve Optimal Control problem · BoundaryValueDiffEq.jl"/><meta property="og:title" content="Solve Optimal Control problem · BoundaryValueDiffEq.jl"/><meta property="twitter:title" content="Solve Optimal Control problem · BoundaryValueDiffEq.jl"/><meta name="description" content="Documentation for BoundaryValueDiffEq.jl."/><meta property="og:description" content="Documentation for BoundaryValueDiffEq.jl."/><meta property="twitter:description" content="Documentation for BoundaryValueDiffEq.jl."/><meta property="og:url" content="https://docs.sciml.ai/BoundaryValueDiffEq/stable/tutorials/optimal_control/"/><meta property="twitter:url" content="https://docs.sciml.ai/BoundaryValueDiffEq/stable/tutorials/optimal_control/"/><link rel="canonical" href="https://docs.sciml.ai/BoundaryValueDiffEq/stable/tutorials/optimal_control/"/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script><link href="../../assets/favicon.ico" rel="icon" type="image/x-icon"/></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../"><img src="../../assets/logo.png" alt="BoundaryValueDiffEq.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../../">BoundaryValueDiffEq.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">BoundaryValueDiffEq.jl: High-Performance Boundary Value Problem Solvers</a></li><li><a class="tocitem" href="../getting_started/">Getting Started with BVP solving in Julia</a></li><li><span class="tocitem">Tutorials</span><ul><li><a class="tocitem" href="../continuation/">Solve BVP with Continuation</a></li><li><a class="tocitem" href="../solve_nlls_bvp/">Solve Overdetermined and Underdetermined BVP</a></li><li><a class="tocitem" href="../unknown_parameters/">Estimate Unknown Parameters in BVP</a></li><li><a class="tocitem" href="../extremum/">Solve BVP with Extremum Boundary Conditions</a></li></ul></li><li><span class="tocitem">Basics</span><ul><li><a class="tocitem" href="../../basics/bvp_problem/">Boundary Value Problems</a></li><li><a class="tocitem" href="../../basics/bvp_functions/">BVP Functions and Jacobian Types</a></li><li><a class="tocitem" href="../../basics/solve/">Common Solver Options (Solve Keyword Arguments)</a></li><li><a class="tocitem" href="../../basics/autodiff/">Automatic Differentiation Backends</a></li><li><a class="tocitem" href="../../basics/error_control/">Error Control Adaptivity</a></li></ul></li><li><span class="tocitem">Solver Summaries and Recommendations</span><ul><li><a class="tocitem" href="../../solvers/mirk/">BoundaryValueDiffEqMIRK</a></li><li><a class="tocitem" href="../../solvers/firk/">BoundaryValueDiffEqFIRK</a></li><li><a class="tocitem" href="../../solvers/shooting/">BoundaryValueDiffEqShooting</a></li><li><a class="tocitem" href="../../solvers/mirkn/">BoundaryValueDiffEqMIRKN</a></li><li><a class="tocitem" href="../../solvers/ascher/">BoundaryValueDiffEqAscher</a></li><li><a class="tocitem" href="../../solvers/simple_solvers/">SimpleBoundaryValueDiffEq</a></li><li><a class="tocitem" href="../../solvers/wrappers/">Wrapper Methods</a></li></ul></li><li><span class="tocitem">Wrapped Solver APIs</span><ul><li><a class="tocitem" href="../../api/odeinterface/">ODEInterface.jl</a></li></ul></li><li><span class="tocitem">Development Documentation</span><ul><li><a class="tocitem" href="../../devdocs/internal_interfaces/">Internal Abstract Types</a></li></ul></li><li><a class="tocitem" href="../../references/">References</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Solve Optimal Control problem</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Solve Optimal Control problem</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/SciML/BoundaryValueDiffEq.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/SciML/BoundaryValueDiffEq.jl/blob/master/docs/src/tutorials/optimal_control.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Solve-Optimal-Control-problem"><a class="docs-heading-anchor" href="#Solve-Optimal-Control-problem">Solve Optimal Control problem</a><a id="Solve-Optimal-Control-problem-1"></a><a class="docs-heading-anchor-permalink" href="#Solve-Optimal-Control-problem" title="Permalink"></a></h1><p>A classical optimal control problem is the rocket launching problem(aka <a href="https://en.wikipedia.org/wiki/Goddard_problem">Goddard Rocket problem</a>). Say we have a rocket with limited fuel and is launched vertically. And we want to control the final altitude of this rocket so that we can make the best of the limited fuel in rocket to get to the highest altitude. In this optimal control problem, the state variables are:</p><ul><li>Velocity of the rocket: <span>$x_v(t)$</span></li><li>Altitude of the rocket: <span>$x_h(t)$</span></li><li>Mass of the rocket and the fuel: <span>$x_m(t)$</span></li></ul><p>The control variable is</p><ul><li>Thrust of the rocket: <span>$u_t(t)$</span></li></ul><p>The dynamics of the launching can be formulated with three differential equations:</p><p>$</p><p>\left{\begin{aligned} &amp;\frac{dx<em>v}{dt}=\frac{u</em>t-drag(x<em>h,x</em>v)}{x<em>m}-g(x</em>h)\
&amp;\frac{dx<em>h}{dt}=x</em>v\
&amp;\frac{dx<em>m}{dt}=-\frac{u</em>t}{c} \end{aligned}\right. $</p><p>where the drag <span>$D(x_h,x_v)$</span> is a function of altitude and velocity:</p><p>$</p><p>D(x<em>h,x</em>v)=D<em>c\cdot x</em>v^2\cdot\exp^{h<em>c(\frac{x</em>h-x<em>h(0)}{x</em>h(0)})} $</p><p>gravity <span>$g(x_h)$</span> is a function of altitude:</p><p>$</p><p>g(x<em>h)=g</em>0\cdot (\frac{x<em>h(0)}{x</em>h})^2 $</p><p class="math-container">\[c\]</p><p>is a constant. Suppose the final time is <span>$T$</span>, we here want to maximize the final altitude <span>$x_h(T)$</span>:</p><p>$</p><p>\max x_h(T) $</p><p>Similar solving for such optimal control problem can be found on JuMP.jl and InfiniteOpt.jl. The detailed parameters are taken from <a href="https://www.mcs.anl.gov/%7Emore/cops/cops3.pdf">COPS</a>.</p><pre><code class="language-julia hljs">using BoundaryValueDiffEqMIRK, OptimizationIpopt
h_0 = 1                      # Initial height
v_0 = 0                      # Initial velocity
m_0 = 1.0                    # Initial mass
m_T = 0.6                    # Final mass
g_0 = 1                      # Gravity at the surface
h_c = 500                    # Used for drag
c = 0.5 * sqrt(g_0 * h_0)    # Thrust-to-fuel mass
D_c = 0.5 * 620 * m_0 / g_0  # Drag scaling
u_t_max = 3.5 * g_0 * m_0    # Maximum thrust
T_max = 0.2                  # Number of seconds
T = 1_000                    # Number of time steps
Δt = 0.2 / T;                # Time per discretized step

tspan = (0.0, 0.2)
drag(x_h, x_v) = D_c * x_v^2 * exp(-h_c * (x_h - h_0) / h_0)
g(x_h) = g_0 * (h_0 / x_h)^2
function rocket_launch!(du, u, p, t)
    # u_t is the control variable (thrust)
    x_v, x_h, x_m, u_t = u[1], u[2], u[3], u[4]
    du[1] = (u_t-drag(x_h, x_v))/x_m - g(x_h)
    du[2] = x_v
    du[3] = -u_t/c
end
function rocket_launch_bc!(res, u, p, t)
    res[1] = u(0.0)[1] - v_0
    res[2] = u(0.0)[2] - h_0
    res[3] = u(0.0)[3] - m_0
    res[4] = u(0.2)[4] - 0.0
end
function constraints!(res, u, p)
    res[1] = u[1]
    res[2] = u[2]
    res[3] = u[3]
    res[4] = u[4]
end
cost_fun(u, p) = -u[end - 2] # To minimize, only temporary, need to use temporary solution interpolation here similar to what we do in boundary condition evaluations.
#cost_fun(sol, p) = -sol(0.2)[2]
u0 = [v_0, h_0, m_0, 0.0]
rocket_launch_fun = BVPFunction(rocket_launch!, rocket_launch_bc!; cost = cost_fun,
    inequality = constraints!, f_prototype = zeros(3))
rocket_launch_prob = BVProblem(rocket_launch_fun, u0, tspan; lcons = [0.0, 0.0, m_T, 0.0],
    ucons = [Inf, Inf, m_0, u_t_max])
sol = solve(rocket_launch_prob, MIRK4(; optimize = IpoptOptimizer()); dt = 0.002)</code></pre><p>Similar optimal control problem solving can also be deployed in JuMP.jl and InfiniteOpt.jl.</p></article><nav class="docs-footer"><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.14.1 on <span class="colophon-date" title="Thursday 9 October 2025 14:26">Thursday 9 October 2025</span>. Using Julia version 1.10.10.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
